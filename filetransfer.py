#!/usr/bin/env python3

import pysftp
import time
import os
import lipsum
import pyminizip

PASSWORD='infected'
path = os.path.join(os.path.expanduser("~/Downloads"))
def create_name():
    name = str(int(time.time())) + ".txt"
    return path + "/" + name

def callback(x, y):
    while y > x:
        print("{} of {} bytes".format(x,y))

def compress(x):
    pyminizip.compress(x, x+'.zip', PASSWORD, 5)
    return x+'.zip'

def go(x):
    filename = create_name()
    def create_temp_file():
        with open(filename, 'x+') as tmp:
            tmp.write(lipsum.generate_words(200))
    create_temp_file()
    filename = compress(filename)
    host = "52.53.198.206"
    user = "ubuntu"
    key = "/Users/beta/.ssh/ubuntu_aws_west.pem"
    time.sleep(1)
    conn = pysftp.Connection(host, user, key)
    dest = '/home/ubuntu/' + filename.split("/")[-1]
    print("Sending {}".format(filename))
    conn.put(filename, dest, callback)

if __name__ == '__main__':
    variable = input("Are you ready?\n")
    go(variable)
